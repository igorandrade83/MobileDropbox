(function(){angular.module("custom.controllers",[]);var a=function(a,b,c,d){window.hostApp?b({method:"GET",url:window.hostApp+"auth/refresh"}).success(function(e){console.log("revive :",new Date(e.expires)),localStorage.setItem("_u",JSON.stringify(e)),setTimeout(function(){$scope.refreshToken(a,b,c,d)},1800000),c()}).error(function(){d()}):a.error("HostApp is required to refresh token!")};app.controller("LoginController",["$scope","$http","$location","$rootScope","$window","$state","$translate","Notification","$ionicLoading","$timeout","$stateParams","$ionicModal",function(b,c,d,e,f,g,h,i,j,k,l,m){function n(a){"undefined"!=typeof Storage&&localStorage.setItem("_u",JSON.stringify(a)),g.go("app.home"),k(function(){j.hide()},500)}function o(a,b){var c=401==b?h.instant("Login.view.invalidPassword"):a;c||(c=h.instant("General.ErrorNotSpecified")),console.log(c),j.hide(),i.error(c)}app.registerEventsCronapi(b,h,m,j),e.http=c,b.Notification=i,b.params=l;var p=d.search();for(var q in p)p.hasOwnProperty(q)&&(b.params[q]=p[q]);for(var r in app.userEvents)b[r]=app.userEvents[r].bind(b);b.autoLogin=function(){localStorage.getItem("_u")&&a(i,c,function(){g.go("app.home")},function(){localStorage.removeItem("_u")})},b.autoLogin(),b.user={username:"",password:""},b.message={},b.login=function(){b.message.error=void 0,window.hostApp?(this.cronapi.screen.showLoading(),c({method:"POST",url:window.hostApp+"auth",data:$.param(b.user),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(n).error(o)):i.error("HostApp is required!")},e.infiniteReached=function(){};try{var s=$controller("AfterLoginController",{$scope:b});app.copyContext(s,this,"AfterLoginController")}catch(a){}try{b.blockly.events.afterLoginRender&&b.blockly.events.afterLoginRender()}catch(a){}}]),app.controller("HomeController",["$scope","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","$ionicLoading","$stateParams","$location",function(b,c,d,e,f,g,h,i,j,k,l,m){app.registerEventsCronapi(b,g,j,k),d.http=c,b.Notification=h,b.params=l;var n=m.search();for(var o in n)n.hasOwnProperty(o)&&(b.params[o]=n[o]);for(var p in app.userEvents)b[p]=app.userEvents[p].bind(b);d.session=localStorage._u?JSON.parse(localStorage._u):null,d.session?d.session.token&&a(h,c,function(){},d.logout):!b.ignoreAuth&&("undefined"!=typeof Storage&&sessionStorage.removeItem("_u"),e.go("login"))}]),app.controller("PublicController",["$controller","$scope",function(a,b){b.ignoreAuth=!0,angular.extend(this,a("HomeController",{$scope:b}))}]),app.controller("MenuController",["$scope","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","$ionicLoading",function(a,b,c,d,e,f,g,h,i,j){for(var k in app.registerEventsCronapi(a,f,i,j),c.http=b,a.Notification=g,a.folder="logged",app.userEvents)a[k]=app.userEvents[k].bind(a);a.ignoreAuth||(i.fromTemplateUrl("views/logged/_changepassword.view.html",{scope:a,animation:"slide-in-up"}).then(function(b){a.modal=b}),a.openChangePassword=function(){a.modal.modelEl?a.modal.show():b({url:"views/logged/_changepassword.view.html"}).then(function(b){a.modal=i.fromTemplate($(b.data).last().text(),{scope:a,animation:"slide-in-up"}),a.modal.show()})},a.closeChangePassword=function(){a.modal.hide()},a.logout=function(){c.session=null,localStorage.removeItem("_u"),d.go("login")}),a.http({method:"GET",url:"views/"+a.folder+"/menu.view.html"}).then(function(b){0<$(b.data).find("ion-nav-bar").length?(a.isOldMenu=!0,0<$(document).find("ion-header-bar").length&&$(document).find("ion-nav-bar").show()):a.isOldMenu=!1})}]),app.controller("PublicMenuController",["$controller","$scope",function(a,b){b.folder="public",angular.extend(this,a("MenuController",{$scope:b}))}]),app.controller("InitialController",["$scope","$stateParams","$http","Notification","$location","$rootScope","$translate","$ionicModal","$ionicLoading","$ionicPlatform",function(a,b,c,d,e,f,g,h,i,j){j.registerBackButtonAction(function(a){a.preventDefault(),a.stopPropagation(),navigator.app.exitApp()},101),app.registerEventsCronapi(a,g,h,i),f.http=c,a.Notification=d,a.params=b,a.$http=c,a.blockly.js.blockly.auth.Home.change()}]),app.controller("chatController",["$scope","$state","$ionicPopup","$ionicScrollDelegate","$timeout","$interval","$ionicModal","$translate","$rootScope","$http","Notification",function(a,b,c,d,f,g,h,i,j,k,l){for(var m in app.registerEventsCronapi(a,i,h,$ionicLoading),j.http=k,a.Notification=l,app.userEvents)a[m]=app.userEvents[m].bind(a);var e,n,o,p=JSON.parse(localStorage._u).user.username,q=d.$getByHandle("userMessageScroll");a.enter=function(){f(function(){e=document.body.querySelector(".homeView .bar-footer"),n=document.body.querySelector(".homeView .scroll-content"),o=angular.element(e.querySelector("textarea"))},0)},a.isEnter=function(a){13==a.keyCode?f(function(){a.stopPropagation(),$("#sendButton").trigger("click")},0):null},a.refreshScroll=function(b,c){f(function(){b=b||a.scrollDown,q.resize(),b&&q.scrollBottom(!0),a.checkScroll()},c||1e3)},a.scrollDown=!0,a.checkScroll=function(){return f(function(){var b=q.getScrollPosition().top,c=q.getScrollView().__maxScrollTop;a.scrollDown=b>=c,a.$apply()},0),!0}}]),app.controller("PageController",["$scope","$stateParams","Notification","$location","$http","$rootScope","$translate","$ionicModal","$ionicLoading",function(a,b,c,d,e,f,g,h,i){app.registerEventsCronapi(a,g,h,i),f.http=e,a.Notification=c,a.params=b,a.$http=e,a.listCanSwipe=!0;var j=d.search();for(var k in j)j.hasOwnProperty(k)&&(a.params[k]=j[k]);if(f.session=null==localStorage.getItem("_u")?null:JSON.parse(localStorage.getItem("_u")),a.registerComponentScripts=function(){$(".carousel-indicators li").on("click",function(){var a="#"+$(this).parent().parent().parent().attr("id"),b=$(a+" .carousel-indicators li").index(this);$(a+" #carousel-example-generic").carousel(b)})},a.registerComponentScripts(),a.isOldMenu){var l=a.params.name||"home";a.http({method:"GET",url:"views/logged/"+l+".view.html"}).then(function(a){0<$(a.data).find("ion-header-bar").length?$(document).find("ion-nav-bar").hide():0<$(document).find("ion-header-bar").length&&$(document).find("ion-nav-bar").show()})}try{var m=$controller("AfterPageController",{$scope:a});app.copyContext(m,this,"AfterPageController")}catch(a){}}]),app.controller("InitialController",["$scope","$stateParams","$http","Notification","$location","$rootScope","$translate","$ionicModal","$ionicLoading","$ionicPlatform",function(a,b,c,d,e,f,g,h,i,j){j.registerBackButtonAction(function(a){a.preventDefault(),a.stopPropagation(),navigator.app.exitApp()},101),app.registerEventsCronapi(a,g,h,i),f.http=c,a.Notification=d,a.params=b,a.$http=c;var k=e.search();for(var l in k)k.hasOwnProperty(l)&&(a.params[l]=k[l]);a.blockly.js.blockly.auth.Home.change()}])})(app),window.safeApply=function(a){var b=this.$root.$$phase;"$apply"==b||"$digest"==b?a&&"function"==typeof a&&a():this.$apply(a)};